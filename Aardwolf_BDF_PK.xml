<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE muclient>
<!-- Saved on Friday, September 30, 2022, 1:49 PM -->
<!-- MuClient version 5.07-pre -->

<!-- Plugin "Aardwolf_BDF_PK" generated by Plugin Wizard -->

<muclient>
<plugin
   name="Aardwolf_BDF_PK"
   author="Pmage"
   id="1417daf76aae95f3c8406270"
   language="Lua"
   purpose="pkalerts"
   save_state="y"
   date_written="2022-09-30 13:40:56"
   requires="5.07"
   version="1.1"
   >
<description>
This script is provide reporting, status, and help running to pk. Along with
some fun alias's you can use.
</description>

</plugin>

<variables>
  <!--<variable name="tet">test</variable>
  <variable name="test">1234</variable>-->
</variables>

	<!-- ********************* Triggers  *********************-->

<triggers>
  <trigger
   enabled="y"
   group="pk"
   match="(Group) *: 'PK Alert:*pkvnum[*]'"
   name="pkgtcapture"
   send_to="12"
   sequence="100"
  >
  <send>
	  local room = %3
	  local  pkhelp = "%1"
	  SetVariable ("pkroomtarg", room)
	  SetVariable ("pkbaby", pkhelp)
	  -- print("1 " .. GetVariable("pkbaby") .. " " .. GetVariable("pkroomtarg")) -- 4 debugging
  </send>
  </trigger>

  <trigger
   enabled="y"
   group="pk"
   match="(Group) *: 'PK Alert:*pkvnum[*] *"
   name="pkgtcapture2"
   send_to="12"
   sequence="100"
  >
  <send>
	  local room = %3
	  local pkhelp = "%1"
	  SetVariable ("pkroomtarg", room)
	  SetVariable ("pkbaby", pkhelp)
	  -- print("2 " .. GetVariable("pkbaby") .. " " .. GetVariable("pkroomtarg")) -- 4 debugging
  </send>
  </trigger> 


  <trigger
   enabled="y"
   group="pk"
   match="* (*) tells the CLAN: 'PK Alert:*pkvnum[*]'"
   name="pkclancapture"
   send_to="12"
   sequence="100"
  >
  <send>
	  local room = %4
	  local pkhelp = "%1"
	  SetVariable ("pkroomtarg", room)
	  SetVariable ("pkbaby", pkhelp)
	  -- print("3 " .. GetVariable("pkbaby") .. " " .. GetVariable("pkroomtarg")) -- 4 debugging
  </send>
  </trigger>

  <trigger
   enabled="y"
   group="pk"
   match="* (*) tells the CLAN: 'PK Alert:*pkvnum[*] *'"
   name="pkclancapture2"
   send_to="12"
   sequence="100"
  >
  <send>
	  local room = %4
	  local pkhelp = "%1"
	  SetVariable ("pkroomtarg", room)
	  SetVariable ("pkbaby", pkhelp)
	  -- print("4 " .. GetVariable("pkbaby") .. " " .. GetVariable("pkroomtarg")) -- 4 debugging
  </send>
  </trigger>
</triggers>



<!-- ********************* Aliases ********************* -->

<aliases>
	<alias
	name="onhelppk"
	script="OnHelp"
	match="Aardwolf_BDF_PK:help"
	enabled="y"
>
	</alias>
  <alias
   name="pkhelp"
   match="pkhelp"
   enabled="y"
   group="pk"
   send_to="12"
   sequence="100"
  >
  <send>
	  local pkhelp = [[
                            BDF PK Help
  =============================================================================
  pkhelp               --> Show this list
  -----------------------------------------------------------------------------
  pkvote        --> GT - Doesn't do anything but wake people up, simple alias.
  pkflee        --> GT - call to RUNAWAY zomg - we don't got the #'s
  pkc *         --> GT - PK come to X (anything)- to bring people to room if they missed alert
  pkr *         --> GT - Calls out for a rescue target = *
  pkrep         --> GT - Sends PK Alert to GT, including zone, room#, you and enemy health
  pkrep ()      --> Same as pkalert, can send to channesl (say|clan|gt) (not FT/Friend/etc)
  pkstatus      --> GT - sends you and enemy status and current room
  pkgo          --> After getting a PK alert - runs you to the room to 'help'
  =============================================================================
  PK alerts for trigger - must mach the following format
	       Start with:       --> "PK Alert:"
	       Have this inline: --> "pkvnum[ROOM#]"
  Currently only grabs from GT or Clan
 ]]
  print(pkhelp)
  </send>
  </alias>

  <alias
   name="pkflee"
   match="pkflee"
   enabled="y"
   group="pk"
   sequence="100"
  >
  <send>sa @R**PK**@W FLEE= @RRetreat home LIVE!
</send>
  </alias>

  <alias
   name="pkwho"
   match="pkvote"
   enabled="y"
   group="pk"
   sequence="100"
  >
  <send>sa @R**PK**@W WHO Wants to @RPK? @W(Y/N)</send>
  </alias>

  <alias
   name="pkcome"
   match="pkc *"
   enabled="y"
   group="pk"
   sequence="100"
  >
  <send>sa @R**PK**@W COME TO = @R%1</send>
  </alias>

  <alias
   name="pkgo"
   match="pkgo"
   enabled="y"
   group="pk"
   send_to="12"
   sequence="100"
  >
  <send>pkroom = tonumber(GetVariable("pkroomtarg"))
pkhelp = GetVariable ("pkbaby")
Execute("gt @WI'm @Ycoming to save you @W" .. pkhelp .. "@Y at:@R" .. pkroom)
Execute("mapper goto ".. pkroom)</send>
  </alias>

  <alias
   name="alert"
   match="pkrep"
   enabled="y"
   group="pk"
   send_to="12"
   sequence="100"
  >
  <send>chan = "gt "
require "gmcphelper" 
local n = gmcp("room.info.num") 
local zn = gmcp("room.info.zone") 
local targ = gmcp("char.status.enemy")
local targperc = gmcp("char.status.enemypct")
local hp = gmcp("char.vitals.hp")
local hpmax = gmcp("char.maxstats.maxhp")
local hpperc = (math.ceil((hp / hpmax)*100))

if targ == "" then
 targ = "bot"
end --if

--output
Execute(chan .." @RPK Alert: @GB@RD@YF @YZONE[@W" .. zn .. "@Y] @Rpkvnum[@W" .. n .. "@Y] " .. "@RTARGET=@W" ..targ .. "|" .. targperc .. " @YME|"..hpperc)</send>
  </alias>

	<!-- **** TEST actual Alert i'm trying to fix to only allow certain channels ****-->
  <alias
   name="alert2"
   match="^pkrep (sa|say|gt|gtell|cl|cla|clan|spo|spouse)"
   enabled="y"
   regexp="y"
   group="pk"
   send_to="12"
   sequence="100"
     >
	<send>
		chan = "%1"
		-- printchan(chan) -- debuging
		require "gmcphelper"
		local n = gmcp("room.info.num")
		local zn = gmcp("room.info.zone")
		local targ = gmcp("char.status.enemy")
		local targperc = gmcp("char.status.enemypct")
		local hp = gmcp("char.vitals.hp")
		local hpmax = gmcp("char.maxstats.maxhp")
		local hpperc = (math.ceil((hp / hpmax)*100))

		if targ == "" then
		targ = "bot"
		end --if

		--output
		Execute(chan .." @RPK Alert: @GB@RD@YF @YZONE[@W" .. zn .. "@Y] @Rpkvnum[@W" .. n .. "@Y] " .. "@RTARGET=@W" ..targ .. "|" .. targperc .. " @YME|"..hpperc)

	</send>
</alias>

  <alias
   name="pktarget"
   match="pkt *"
   enabled="y"
   group="pk"
   sequence="100"
  >
  <send>gt @R**PK**@W TARGET = @R%1</send>
  </alias>
	
  <alias
   name="status"
   match="pkstatus"
   enabled="y"
   group="pk"
   send_to="12"
   sequence="100"
  >
  <send>chan = "gt"
require "gmcphelper" 
local n = gmcp("room.info.num") 
local targ = gmcp("char.status.enemy")
local targperc = gmcp("char.status.enemypct")
local hp = gmcp("char.vitals.hp")
local hpmax = gmcp("char.maxstats.maxhp")
local hpperc = (math.ceil((hp / hpmax)*100))

if targ == "" then
 targ = "bot"
end --if

--output
Execute(chan .." @RPK Status: @GB@RD@YF @Rpkvnum[@W" .. n .. "@Y] " .. "@RTARGET=@W" ..targ .. "|" .. targperc .. " @YME|"..hpperc)</send>
  </alias>

  <alias
   name="pkrescue"
   match="pkr *"
   enabled="y"
   group="pk"
   sequence="100"
  >
  <send>gt @R**PK**@W rescue = @R%1</send>
  </alias>
</aliases>

	<script>
<![CDATA[
function OnHelp ()
 print(world.GetPluginInfo (world.GetPluginID (), 3))
 print(" ******** Please check 'pkhelp' ******** " )
end --function

function printchan(char)
 print(char)
end -- function

function OnPluginInstall()
	print("Plugin Initialized: " .. GetPluginName() )
	print(" ******** Please check 'pkhelp' ******** " )
end --endfunc


]]>
	</script>
</muclient>
